(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{473:function(t,s,n){"use strict";n.r(s);var a=n(49),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("p",[t._v("Mirai 的配置异常的简单，我们仅需要一些简单的配置即可使用 Mirai 的强大功能！")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("在讲解配置之前，请确保您已经安装了 Mirai，如果您尚未安装，请查看 "),n("RouterLink",{attrs:{to:"/guide/install.html"}},[t._v("安装")]),t._v(" 一章。")],1)]),t._v(" "),n("h2",{attrs:{id:"mirai-guide-build-for-mirai"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mirai-guide-build-for-mirai"}},[t._v("#")]),t._v(" Mirai Guide - Build For Mirai")]),t._v(" "),n("p",[t._v("由于Mirai项目在快速推进中，因此内容时有变动，本文档的最后更新日期为"),n("code",[t._v("2020-02-29")]),t._v("，对应版本"),n("code",[t._v("0.23.0")])]),t._v(" "),n("p",[t._v("本页面采用Kotlin作为开发语言，"),n("strong",[t._v("若你希望使用 Java 开发")]),t._v(", 请参阅: "),n("a",{attrs:{href:"https://github.com/mamoe/mirai-japt",target:"_blank",rel:"noopener noreferrer"}},[t._v("mirai-japt"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("本页面是"),n("RouterLink",{attrs:{to:"/docs/guide_subscribe_events.html"}},[t._v("Mirai Guide - Subscribe Events")]),t._v("的后续Guide")],1),t._v(" "),n("h2",{attrs:{id:"build-gradle"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-gradle"}},[t._v("#")]),t._v(" build.gradle")]),t._v(" "),n("p",[t._v("我们首先来看一下完整的"),n("code",[t._v("build.gradle")]),t._v("文件")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.jetbrains.kotlin.jvm'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.3.61'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ngroup "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nversion "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.0-SNAPSHOT'")]),t._v("\n\nsourceCompatibility "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.8")]),t._v("\n\nrepositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavenCentral")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ndependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    implementation "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net.mamoe:mirai-core-qqandroid-jvm:0.19.1'")]),t._v("\n    implementation "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"org.jetbrains.kotlin:kotlin-stdlib-jdk8"')]),t._v("\n    testCompile group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'4.12'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ncompileKotlin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    kotlinOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jvmTarget "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"1.8"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ncompileTestKotlin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    kotlinOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jvmTarget "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"1.8"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("使用gradle直接打包，不会将依赖也打包进去")]),t._v(" "),n("p",[t._v("因此，我们引入一些插件进行打包")]),t._v(" "),n("h3",{attrs:{id:"shadowjar"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shadowjar"}},[t._v("#")]),t._v(" ShadowJar")]),t._v(" "),n("p",[t._v("shadowJar支持将依赖也打包到Jar内，下面介绍用法。")]),t._v(" "),n("h4",{attrs:{id:"_1-buildscript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-buildscript"}},[t._v("#")]),t._v(" 1.buildscript")]),t._v(" "),n("p",[t._v("首先声明buildScript")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("buildscript "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    repositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    dependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        classpath "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.jengelman.gradle.plugins:shadow:5.2.0'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("在plugin前加入以上语句")]),t._v(" "),n("h4",{attrs:{id:"_2-在plugins中进行插件的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-在plugins中进行插件的使用"}},[t._v("#")]),t._v(" 2.在plugins中进行插件的使用")]),t._v(" "),n("p",[t._v("将原本的plugins")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.jetbrains.kotlin.jvm'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.3.61'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("覆盖为")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.jetbrains.kotlin.jvm'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.3.61'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.johnrengelman.shadow'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5.2.0'")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用shadow对依赖进行打包")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\napply plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.johnrengelman.shadow'")]),t._v("\napply plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n")])])]),n("h4",{attrs:{id:"_3-添加shadowjar"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加shadowjar"}},[t._v("#")]),t._v(" 3.添加shadowJar")]),t._v(" "),n("p",[t._v("在文件底部添加")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("shadowJar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生成包的命名规则： baseName-version-classifier.jar")]),t._v("\n    manifest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("attributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Main-Class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net.mamoe.mirai.simpleloader.MyLoaderKt'")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//入口点")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将 build.gradle 打入到 jar 中, 方便查看依赖包版本")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"./"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        include "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build.gradle'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"_4-运行build"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-运行build"}},[t._v("#")]),t._v(" 4.运行build")]),t._v(" "),n("p",[t._v("在IDEA中点击"),n("code",[t._v("ShadowJar")]),t._v("左侧的run按钮(绿色小三角)，build完成后在"),n("code",[t._v("build\\libs")]),t._v("中找到jar")]),t._v(" "),n("p",[t._v("至此，build.gradle内的内容是")]),t._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[t._v("buildscript "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    repositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    dependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        classpath "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.jengelman.gradle.plugins:shadow:5.2.0'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\nplugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.jetbrains.kotlin.jvm'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.3.61'")]),t._v("\n    id "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.johnrengelman.shadow'")]),t._v(" version "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5.2.0'")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用shadow对依赖进行打包")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\napply plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.github.johnrengelman.shadow'")]),t._v("\napply plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n\ngroup "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nversion "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.0-SNAPSHOT'")]),t._v("\n\nsourceCompatibility "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.8")]),t._v("\n\n\nrepositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavenCentral")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ndependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    implementation "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net.mamoe:mirai-core-qqandroid-jvm:0.23.0'")]),t._v("\n    implementation "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"org.jetbrains.kotlin:kotlin-stdlib-jdk8"')]),t._v("\n    testCompile group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'junit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'4.12'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\ncompileKotlin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    kotlinOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jvmTarget "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"1.8"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ncompileTestKotlin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    kotlinOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jvmTarget "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"1.8"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nshadowJar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生成包的命名规则： baseName-version-classifier.jar")]),t._v("\n    manifest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("attributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Main-Class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net.mamoe.mirai.simpleloader.MyLoaderKt'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将 build.gradle 打入到 jar 中, 方便查看依赖包版本")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"./"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        include "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build.gradle'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);